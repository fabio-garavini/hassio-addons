#!/command/with-contenv bashio
# shellcheck shell=bash

set -e

certfile="/ssl/$(bashio::config 'certfile')"
keyfile="/ssl/$(bashio::config 'keyfile')"

if ! bashio::fs.file_exists "$certfile" || ! bashio::fs.file_exists "$keyfile"; then
    bashio::log.warning "SSL is enabled, but certfile or keyfile is missing. Using self-signed certificate..."

    certfile="/config/keys/cert.crt"
    keyfile="/config/keys/cert.key"

    if ! bashio::fs.file_exists "$certfile" || ! bashio::fs.file_exists "$keyfile"; then
        /usr/local/bin/selfsigned-ssl-gen.sh "$certfile" "$keyfile"
    else
        /usr/local/bin/check-ssl.sh "$certfile" "$keyfile"
    fi
fi
